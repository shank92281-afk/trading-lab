<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Trading Lab â€” Login</title>
</head>
<body>
  <h1>Login</h1>

  <div style="max-width:360px;">
    <label>Username</label><br>
    <input id="username" type="text" style="width:100%; padding:8px;"><br><br>

    <label>Password</label><br>
    <input id="password" type="password" style="width:100%; padding:8px;"><br><br>

    <button onclick="login()" style="padding:8px 12px;">Login</button>

    <p id="msg"></p>

    <p>New? <a href="signup.html">Create account</a></p>
  </div>

<script>
const AUTH_BASE = "http://localhost:8004";

async function login(){
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value;

  if(!username || !password){
    document.getElementById("msg").innerText = "Provide username and password.";
    return;
  }

  try {
    const res = await fetch(AUTH_BASE + "/login", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ username, password })
    });

    const data = await res.json().catch(()=>({error:"invalid json"}));

    if(res.ok && data.access_token){
      localStorage.setItem("token", data.access_token);
      localStorage.setItem("username", username);
      document.getElementById("msg").innerText = "Login successful. Redirecting to Place Order...";
      setTimeout(()=> location.href = "place_order.html", 800);
    } else {
      document.getElementById("msg").innerText = (data.detail || data.error || JSON.stringify(data));
    }
  } catch(err){
    document.getElementById("msg").innerText = "Network error: " + err.message;
  }
}
</script>
</body>
</html>

